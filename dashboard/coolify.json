{
  "name": "mobile-repair-dashboard",
  "description": "Mobile Repair Shop Dashboard - Production Ready",
  "type": "application",
  "build": {
    "type": "dockerfile",
    "dockerfile": "Dockerfile.production",
    "context": ".",
    "args": {
      "NODE_ENV": "production"
    }
  },
  "port": 3000,
  "environment": {
    "NODE_ENV": "production",
    "PORT": "3000",
    "NEXT_TELEMETRY_DISABLED": "1",
    "HOSTNAME": "0.0.0.0"
  },
  "services": {
    "postgres": {
      "image": "postgres:15-alpine",
      "environment": {
        "POSTGRES_DB": "mobile_repair_db",
        "POSTGRES_USER": "repair_admin",
        "POSTGRES_PASSWORD": "${POSTGRES_PASSWORD}"
      },
      "volumes": [
        "postgres_data:/var/lib/postgresql/data"
      ],
      "healthcheck": {
        "test": ["CMD-SHELL", "pg_isready -U repair_admin -d mobile_repair_db"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 5,
        "start_period": "30s"
      }
    },
    "redis": {
      "image": "redis:7-alpine",
      "command": "redis-server --appendonly yes --requirepass ${REDIS_PASSWORD:-}",
      "volumes": [
        "redis_data:/data"
      ],
      "healthcheck": {
        "test": ["CMD", "redis-cli", "ping"],
        "interval": "10s",
        "timeout": "5s",
        "retries": 5
      }
    }
  },
  "healthcheck": {
    "path": "/api/health",
    "interval": 30,
    "timeout": 10,
    "retries": 3,
    "start_period": 60
  },
  "commands": {
    "postDeploy": [
      "npx prisma migrate deploy",
      "npx prisma generate"
    ]
  },
  "volumes": [
    "postgres_data",
    "redis_data"
  ],
  "restart": "unless-stopped"
}
